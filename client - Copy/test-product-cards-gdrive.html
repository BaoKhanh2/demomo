<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Google Drive Images - Product Cards</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .debug-info {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .status {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fa-solid fa-images"></i> Test Google Drive Images</h1>
            <p>Ki·ªÉm tra hi·ªÉn th·ªã ·∫£nh s·∫£n ph·∫©m t·ª´ Google Drive</p>
        </div>
        
        <div class="status" id="status">
            <strong>Status:</strong> <span id="statusText">ƒêang t·∫£i...</span>
        </div>
        
        <div class="debug-info" id="debugInfo">
            <strong>Debug Info:</strong><br>
            <div id="debugContent">Kh·ªüi t·∫°o h·ªá th·ªëng...</div>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <!-- Products will be loaded here -->
        </div>
    </div>

    <!-- Load Dependencies -->
    <script src="js/utils/googleDriveImageHelper.js"></script>
    <script src="js/api/apiClient.js"></script>
    <script src="js/components/productCard.js"></script>

    <script>
        // Test products with Google Drive IDs
        const testProducts = [
            {
                id: "test1",
                name: "√Åo thun tay ng·∫Øn nam",
                description: "√Åo thun cotton cao c·∫•p, tho√°ng m√°t",
                price: 299000,
                actualPrice: 399000,
                stock: 10,
                googleDriveId: "1234567890abcdef", // Test Google Drive ID
                imageUrl: "1234567890abcdef"
            },
            {
                id: "test2", 
                name: "Qu·∫ßn jeans nam",
                description: "Qu·∫ßn jeans denim ch·∫•t l∆∞·ª£ng cao",
                price: 599000,
                stock: 5,
                googleDriveId: "https://drive.google.com/file/d/1xyz789/view?usp=sharing"
            },
            {
                id: "test3",
                name: "Gi√†y sneaker",
                description: "Gi√†y th·ªÉ thao nƒÉng ƒë·ªông, phong c√°ch",
                price: 799000,
                actualPrice: 999000,
                stock: 0,
                imageUrl: "https://drive.google.com/uc?id=1abc123&export=download"
            }
        ];

        function updateStatus(message, isError = false) {
            const statusElement = document.getElementById('statusText');
            statusElement.textContent = message;
            statusElement.style.color = isError ? '#e74c3c' : '#27ae60';
        }

        function addDebugInfo(info) {
            const debugContent = document.getElementById('debugContent');
            const timestamp = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<br>[${timestamp}] ${info}`;
        }

        async function testGoogleDriveImages() {
            try {
                updateStatus('ƒêang ki·ªÉm tra h·ªá th·ªëng...');
                addDebugInfo('üîß B·∫Øt ƒë·∫ßu ki·ªÉm tra h·ªá th·ªëng Google Drive Image Helper');

                // Check if GoogleDriveImageHelper is loaded
                if (!window.GoogleDriveImageHelper) {
                    throw new Error('GoogleDriveImageHelper kh√¥ng ƒë∆∞·ª£c t·∫£i');
                }
                addDebugInfo('‚úÖ GoogleDriveImageHelper ƒë√£ ƒë∆∞·ª£c t·∫£i');

                // Check if ProductCard is loaded
                if (!window.ProductCard) {
                    throw new Error('ProductCard kh√¥ng ƒë∆∞·ª£c t·∫£i');
                }
                addDebugInfo('‚úÖ ProductCard ƒë√£ ƒë∆∞·ª£c t·∫£i');

                updateStatus('ƒêang t·∫°o product cards...');
                addDebugInfo('üéØ B·∫Øt ƒë·∫ßu t·∫°o product cards');

                const productsGrid = document.getElementById('productsGrid');
                
                testProducts.forEach((product, index) => {
                    addDebugInfo(`üì¶ T·∫°o card cho s·∫£n ph·∫©m: ${product.name}`);
                    
                    try {
                        const productCard = new ProductCard(product);
                        const cardElement = productCard.createElement();
                        productsGrid.appendChild(cardElement);
                        
                        addDebugInfo(`‚úÖ Card ${index + 1} t·∫°o th√†nh c√¥ng`);
                    } catch (error) {
                        addDebugInfo(`‚ùå L·ªói t·∫°o card ${index + 1}: ${error.message}`);
                    }
                });

                updateStatus('‚úÖ Ho√†n th√†nh! Ki·ªÉm tra console ƒë·ªÉ xem chi ti·∫øt.');
                addDebugInfo('üéâ Ho√†n th√†nh t·∫°o t·∫•t c·∫£ product cards');

            } catch (error) {
                updateStatus(`‚ùå L·ªói: ${error.message}`, true);
                addDebugInfo(`üí• L·ªói nghi√™m tr·ªçng: ${error.message}`);
                console.error('Test Error:', error);
            }
        }

        // Test Google Drive Image Helper functions
        function testImageHelper() {
            addDebugInfo('üß™ Test GoogleDriveImageHelper functions:');
            
            const testCases = [
                "1234567890abcdef",
                "https://drive.google.com/file/d/1xyz789/view?usp=sharing",
                "https://drive.google.com/uc?id=1abc123&export=download",
                "./public/images/test.jpg"
            ];

            testCases.forEach((testCase, index) => {
                try {
                    const result = window.GoogleDriveImageHelper.processGoogleDriveImage(testCase);
                    addDebugInfo(`  ${index + 1}. Input: ${testCase}`);
                    addDebugInfo(`     Output: ${result}`);
                } catch (error) {
                    addDebugInfo(`  ${index + 1}. Error: ${error.message}`);
                }
            });
        }

        // Start the test when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                testImageHelper();
                testGoogleDriveImages();
            }, 500);
        });

        // Log all console messages to debug area
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        console.log = function(...args) {
            originalLog.apply(console, args);
            addDebugInfo(`üìù LOG: ${args.join(' ')}`);
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addDebugInfo(`‚ö†Ô∏è WARN: ${args.join(' ')}`);
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addDebugInfo(`‚ùå ERROR: ${args.join(' ')}`);
        };
    </script>
</body>
</html>
